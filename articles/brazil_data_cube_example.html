<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example of using the rstac package with bdc STAC • rstac</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example of using the rstac package with bdc STAC">
<meta property="og:description" content="rstac">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstac</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example of using the rstac package with bdc STAC</h1>
                        <h4 class="author">Felipe Carvalho and Rolf Simões</h4>
            
            <h4 class="date">Latest version: 2020-07-26</h4>
      
      
      <div class="hidden name"><code>brazil_data_cube_example.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><a href="http://brazildatacube.org/about-brazil-data-cube/">Brazil Data Cube</a> is a project that is being developed by Brazil’s National Institute for Space Research (INPE ), since January 2019, that aims to create multidimensional data cubes of analysis-ready from medium-resolution Earth observation images for all Brazilian territory and to generate land use and cover information from these data cubes using machine learning and satellite image time series analysis.</p>
<div id="setup" class="section level3">
<h3 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h3>
<p>In addition to <strong>rstac</strong> we’ll load the following packages:</p>
<ul>
<li>
<strong>magrittr</strong>, to use pipe (<code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code>) object.</li>
<li>
<strong>raster</strong>, to read the assets from STAC API.</li>
</ul>
<div class="sourceCode" id="cb1"><html><body><pre class="r">  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rstac</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)</pre></body></html></div>
</div>
<div id="stac-catalog" class="section level3">
<h3 class="hasAnchor">
<a href="#stac-catalog" class="anchor"></a>STAC Catalog</h3>
<div class="sourceCode" id="cb2"><html><body><pre class="r">  <span class="no">stac_catalog</span> <span class="kw">&lt;-</span> <span class="kw pkg">rstac</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstac/man/stac.html">stac</a></span>(<span class="kw">url</span> <span class="kw">=</span>                                 <span class="st">"http://brazildatacube.dpi.inpe.br/bdc-stac/0.8.0"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">rstac</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstac/man/get_request.html">get_request</a></span>(<span class="no">.</span>)</pre></body></html></div>
<p>Note: After creating the STAC object you must call up the requisition methods you want to use, in this example we will use the <code>GET</code> method.</p>
<p>Visualization of the provided catalog of the BDC:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">  <span class="no">itms_sort</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">stac_catalog</span>$<span class="no">links</span>, <span class="kw">function</span>(<span class="no">x</span>){
    <span class="no">x</span>$<span class="no">title</span>}) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>()

  <span class="co"># to divide into two parts</span>
 <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">col.names</span> <span class="kw">=</span> <span class="st">"Product Items"</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">itms_sort</span>[<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">itms_sort</span>) / <span class="fl">2</span>)],
                  <span class="no">itms_sort</span>[<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">itms_sort</span>) / <span class="fl">2</span> + <span class="fl">1</span>,      <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">itms_sort</span>))]))</pre></body></html></div>
<table class="table kable_wrapper"><tbody><tr>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">Product Items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">C4_64</td>
</tr>
<tr class="even">
<td align="left">C4_64_16D_MED</td>
</tr>
<tr class="odd">
<td align="left">C4_64_16D_STK</td>
</tr>
<tr class="even">
<td align="left">C4_64_1M_MED</td>
</tr>
<tr class="odd">
<td align="left">C4_64_1M_STK</td>
</tr>
<tr class="even">
<td align="left">CB4_64</td>
</tr>
<tr class="odd">
<td align="left">CB4_64_16D_STK</td>
</tr>
<tr class="even">
<td align="left">CB4A_55</td>
</tr>
<tr class="odd">
<td align="left">CB4A_55_1M_STK</td>
</tr>
<tr class="even">
<td align="left">CB4MOSBR_64</td>
</tr>
<tr class="odd">
<td align="left">CB4MOSBR_64_1M_STK</td>
</tr>
<tr class="even">
<td align="left">CB4MOSBR_64_3M_STK</td>
</tr>
<tr class="odd">
<td align="left">HLS.L30</td>
</tr>
<tr class="even">
<td align="left">HLS.S30</td>
</tr>
<tr class="odd">
<td align="left">L5DN</td>
</tr>
<tr class="even">
<td align="left">L5SR</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">Product Items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">LC8_30</td>
</tr>
<tr class="even">
<td align="left">LC8_30_16D_STK</td>
</tr>
<tr class="odd">
<td align="left">LC8_30_1M_MED</td>
</tr>
<tr class="even">
<td align="left">LC8_30_1M_STK</td>
</tr>
<tr class="odd">
<td align="left">LC8DN</td>
</tr>
<tr class="even">
<td align="left">LC8SR</td>
</tr>
<tr class="odd">
<td align="left">MOD13Q1</td>
</tr>
<tr class="even">
<td align="left">MYD13Q1</td>
</tr>
<tr class="odd">
<td align="left">S2_10</td>
</tr>
<tr class="even">
<td align="left">S2_10_16D_MED</td>
</tr>
<tr class="odd">
<td align="left">S2_10_16D_STK</td>
</tr>
<tr class="even">
<td align="left">S2_10_1M_MED</td>
</tr>
<tr class="odd">
<td align="left">S2_10_1M_STK</td>
</tr>
<tr class="even">
<td align="left">S2_MSI_L2_SR_LASRC</td>
</tr>
<tr class="odd">
<td align="left">S2SR_SEN28</td>
</tr>
<tr class="even">
<td align="left">S2TOA</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody></table>
</div>
<div id="search-assets" class="section level3">
<h3 class="hasAnchor">
<a href="#search-assets" class="anchor"></a>Search assets</h3>
<p>Let’s use the <code><a href="https://rdrr.io/pkg/rstac/man/stac_search.html">rstac::stac_search()</a></code> function to search for the assets we want. In this function we can set up more technical searches that allows us to search for collections. Let’s get the assets of the <strong>MOD13Q1</strong> collection. For more information see the documentation using <code><a href="https://rdrr.io/pkg/rstac/man/rstac.html">help(rstac)</a></code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">stac_items</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">rstac</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstac/man/stac_search.html">stac_search</a></span>(<span class="kw">url</span> <span class="kw">=</span> <span class="st">"http://brazildatacube.dpi.inpe.br/bdc-stac/0.8.0"</span>,
                     <span class="kw">collections</span> <span class="kw">=</span> <span class="st">"MOD13Q1"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">rstac</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstac/man/get_request.html">get_request</a></span>(<span class="no">.</span>)</pre></body></html></div>
<p>Done. Now we have our items from the STAC catalog. Now let’s see how many items were returned from that search.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r">  <span class="no">stac_items</span> <span class="kw">%&gt;%</span> <span class="kw pkg">rstac</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstac/man/items_length.html">items_length</a></span>(<span class="no">.</span>)</pre></body></html></div>
<pre><code>## [1] 10</code></pre>
<p>Cool. By default, our API return has a limit of 10 items, but this parameter can easily be changed, so please see the documentation.</p>
<p>If you want to find all returned items from STAC API, use <code><a href="https://rdrr.io/pkg/rstac/man/items_fetch.html">rstac::items_fetch()</a></code>. For this simple example, we will not use the pagination function.</p>
</div>
<div id="use-assets-in-r" class="section level3">
<h3 class="hasAnchor">
<a href="#use-assets-in-r" class="anchor"></a>Use assets in R</h3>
<p>There are two options for using assets from STAC. Use the <code><a href="https://rdrr.io/pkg/rstac/man/assets_download.html">rstac::assets_download()</a></code> function to download them, and in the case of images, we can use the <strong>raster</strong> package to read them.</p>
<p>First, let’s look at our assets, using the <code>rstac::item_assets()</code> function.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">  <span class="no">items_assets</span> <span class="kw">&lt;-</span> <span class="no">stac_items</span> <span class="kw">%&gt;%</span> <span class="kw pkg">rstac</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstac/man/items_assets.html">items_assets</a></span>(<span class="no">.</span>)

  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">items_assets</span>, <span class="kw">function</span>(<span class="no">x</span>){
    <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="no">x</span>$<span class="no">assets_name</span>, <span class="kw">col.names</span> <span class="kw">=</span> <span class="no">x</span>$<span class="no">collection_name</span>)
  })</pre></body></html></div>
<pre><code>## [[1]]
## 
## 
## |MOD13Q1.A2019305.h10v09.006.2019323202805 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[2]]
## 
## 
## |MOD13Q1.A2019305.h11v08.006.2019323202021 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[3]]
## 
## 
## |MOD13Q1.A2019305.h11v09.006.2019323202130 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[4]]
## 
## 
## |MOD13Q1.A2019305.h11v10.006.2019323202130 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[5]]
## 
## 
## |MOD13Q1.A2019305.h11v11.006.2019323202633 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[6]]
## 
## 
## |MOD13Q1.A2019305.h12v08.006.2019323202130 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[7]]
## 
## 
## |MOD13Q1.A2019305.h12v09.006.2019323201918 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[8]]
## 
## 
## |MOD13Q1.A2019305.h12v10.006.2019323202118 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[9]]
## 
## 
## |MOD13Q1.A2019305.h12v11.006.2019323202954 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |
## 
## [[10]]
## 
## 
## |MOD13Q1.A2019305.h12v12.006.2019323202527 |
## |:-----------------------------------------|
## |blue                                      |
## |evi                                       |
## |ndvi                                      |
## |nir                                       |
## |red                                       |
## |reliability                               |
## |swir2                                     |
## |thumbnail                                 |</code></pre>
<p>Now, let’s see some image directly through R:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r">  <span class="no">image_blue</span> <span class="kw">&lt;-</span> <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"/vsicurl/"</span>,
                            <span class="no">stac_items</span>$<span class="no">features</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">assets</span>$<span class="no">blue</span>$<span class="no">href</span>))

  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">image_blue</span>)</pre></body></html></div>
<p><img src="brazil_data_cube_example_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<p>To download the assets in your machine, use:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r">  <span class="no">stac_items</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/rstac/man/assets_download.html">assets_download</a></span>(<span class="no">.</span>, <span class="kw">assets_name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"thumbnail"</span>),
                                 <span class="kw">output_dir</span> <span class="kw">=</span> <span class="st">"my-dir/"</span>)</pre></body></html></div>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ul>
<li>Zaglia, Matheus C., et al. “Catalogaçao de Metadados do Cubo de Dados do Brasil com o SpatioTemporal Asset Catalog.” GEOINFO, 20 Years After! (2019): 280</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brazil Data Cube Team, Rolf Simoes, Felipe Carvalho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
